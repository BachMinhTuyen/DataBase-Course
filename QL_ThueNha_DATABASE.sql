--CREATE DATABASE QL_THUENHA 
--GO

USE QL_THUENHA 
GO

CREATE TABLE LOAINHA
(
	MALN CHAR(3) NOT NULL PRIMARY KEY,
	TENLN NVARCHAR(10),
	GHICHU NVARCHAR(30)
)

CREATE TABLE NHA
(
	MANHA CHAR(5) NOT NULL PRIMARY KEY,
	DIACHI NVARCHAR(50),
	TIENTHUE INT,
	MALN CHAR(3),
	CONSTRAINT FK_MALN_NHA FOREIGN KEY (MALN) REFERENCES LOAINHA(MALN)
)

CREATE TABLE KHACHHANG
(
	MAKH CHAR(5) NOT NULL PRIMARY KEY,
	TENKH NVARCHAR(30),
	DIACHI NVARCHAR(40),
	DTHOAI VARCHAR(10),
	KHANANGTHUE INT
)

CREATE TABLE DANGTIN
(
	MANHA CHAR(5) NOT NULL,
	NGAYDANG DATE NOT NULL,
	THOIHANDT INT,
	CONSTRAINT PK_DANGTIN PRIMARY KEY(MANHA, NGAYDANG),
	CONSTRAINT FK_MANHA_DANGTIN FOREIGN KEY (MANHA) REFERENCES NHA(MANHA)
)

CREATE TABLE XEMNHA
(
	MANHA CHAR(5) NOT NULL,
	MAKH CHAR(5) NOT NULL,
	NGAYXEMNHA DATE,
	KETLUAN NVARCHAR(30),
	CONSTRAINT PK_XEMNHA PRIMARY KEY (MANHA, MAKH),
	CONSTRAINT FK_MANHA_XEMNHA FOREIGN KEY (MANHA) REFERENCES NHA(MANHA),
	CONSTRAINT FK_MAKH_XEMNHA FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH)
)

INSERT INTO LOAINHA(MALN, TENLN)
VALUES ('NC1', N'Cấp 1'),
('NC2', N'Cấp 2'),
('NC3', N'Cấp 3'),
('NC4', N'Cấp 4')

INSERT INTO NHA(MANHA, DIACHI, TIENTHUE, MALN)
VALUES ('C2001', N'142 Lê Trọng Tấn, Tân Phú, TP. HCM', 10000000, 'NC2'),
('C3001', N'111 Bình Thới, Q11, TP. HCM', 7000000, 'NC3'),
('C4001', N'123 Tân Thới Nhất, Quận 12, TP. HCM', 4000000, 'NC4'),
('C4002', N'21 Tô Ký, Quận 12, TP. HCM', 3500000, 'NC4')

INSERT INTO KHACHHANG(MAKH, TENKH, DIACHI, DTHOAI, KHANANGTHUE)
VALUES ('KH001', N'Trần Thanh Bình', N'123, Trương Định, Q3, TP. HCM', '0989123456', 10000000),
('KH002', N'Trần Thị Lan', N'01, Lê Lai, Q1, TP. HCM', '0918456234', 9000000),
('KH003', N'Lê Thành Nam', N'12, Ngô Quyền, Q5, TP. HCM', '0909657456', 11000000),
('KH004', N'Nguyễn Thảo Mi', N'120, Thành Thái, Q10, TP. HCM', '0912657489', 3000000),
('KH005', N'Lê Anh Tuấn', N'123, Trương Định, Q3, TP. HCM', '0989768567', 4000000)

INSERT INTO DANGTIN(MANHA, NGAYDANG, THOIHANDT)
VALUES ('C2001', '2016-05-01', 7),
('C4002', '2016-05-02', 10),
('C4001', '2016-06-04', 30),
('C4001', '2016-06-13', 7),
('C3001', '2016-06-12', 7)

INSERT INTO XEMNHA(MANHA, MAKH, NGAYXEMNHA)
VALUES ('C2001', 'KH003', '2016-05-07'),
('C4002', 'KH002', '2016-05-07'),
('C4001', 'KH004', '2016-06-05'),
('C4001', 'KH002', '2016-06-14'),
('C3001', 'KH001', '2016-06-15')